#!/bin/sh

export LOCKINF=../bin/cilly

# to make sure the sorting works the same all the time
export LANG=C

rm -rf out
test -d out || mkdir out
test -f core && rm core

case `echo -n` in
  '')  n='-n' c='' ;;
  *)   n=''   c='\c' ;;
esac

for i in *.c; do
  echo $n "$i$c"
  $LOCKINF $i > out/$i.out 2>&1
  if [ -f core ]; then
    echo ' -- core dumped!'
    /bin/rm core
  else
    echo
  fi
done

# Ignore any lines with /tmp in them, since the tmp file names may change
test -f core || diff --recur --exclude=CVS --ignore-matching-lines="/tmp" ok out | ${PAGER:-less}

/bin/rm -f core
/bin/rm -f a.out
